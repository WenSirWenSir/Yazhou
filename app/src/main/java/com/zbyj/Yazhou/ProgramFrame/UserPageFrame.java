package com.zbyj.Yazhou.ProgramFrame;import android.Manifest;import android.annotation.SuppressLint;import android.app.Activity;import android.app.AlertDialog;import android.app.FragmentTransaction;import android.graphics.Color;import android.graphics.drawable.GradientDrawable;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.support.v4.app.ActivityCompat;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentManager;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.ListView;import android.widget.RelativeLayout;import android.widget.TextView;import android.widget.Toast;import com.zbyj.Yazhou.LeftCompanyProgram.CompanyClass.LeftCompanyProgramFragment;import com.zbyj.Yazhou.LeftCompanyProgram.CompanyPage.USER_KEY_PAGE;import com.zbyj.Yazhou.LeftCompanyProgram.Config;import com.zbyj.Yazhou.LeftCompanyProgram.ConfigPageClass;import com.zbyj.Yazhou.LeftCompanyProgram.Tools;import com.zbyj.Yazhou.ProgramAct.ExchangeAct;import com.zbyj.Yazhou.ProgramAct.UserAllAddrsAct;import com.zbyj.Yazhou.ProgramAct.UserHelpCenter;import com.zbyj.Yazhou.R;import java.util.ArrayList;import java.util.List;import java.util.Timer;import java.util.TimerTask;public class UserPageFrame extends LeftCompanyProgramFragment {    private RelativeLayout rl_headimg, rl_fbackground;    private ImageView btn_addr;    private int index = 6;    private List<ImageView> navList = new ArrayList<ImageView>();    private final int UPDATE_ANMIATION = 0;    private Timer timer;    private Handler handler;    @Override    @SuppressLint({"NewApi", "ResourceType", "HandlerLeak"})    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle            savedInstanceState) {        View view = LayoutInflater.from(getContext()).inflate(R.layout.framelayout_userpage, null);        //动画更新线程        handler = new Handler() {            @Override            public void handleMessage(Message msg) {                switch (msg.what) {                    case UPDATE_ANMIATION:                        if (navList.get((Integer) msg.obj) != null) {                            navList.get((Integer) msg.obj).setVisibility(View.VISIBLE);                        }                        else{                            timer.cancel();                        }                        break;                    default:                        break;                }                super.handleMessage(msg);            }        };        init(view);        return view;    }    @SuppressLint({"NewApi", "ResourceType"})    private void init(View view) {        rl_headimg = view.findViewById(R.id.activity_usercontext_headImg);        rl_fbackground = view.findViewById(R.id.activity_usercontext_fBackground);        //界面的监听图片找        btn_addr = view.findViewById(R.id.activity_usercontext_btnPage_addrImage);        /**         * 设置图片的边框颜色         */        GradientDrawable gradientDrawable = new GradientDrawable();        gradientDrawable.setStroke(5, Color.parseColor("#efefef"));        gradientDrawable.setColor(Color.parseColor("#efefef"));        gradientDrawable.setCornerRadius(10);        gradientDrawable.setGradientType(GradientDrawable.RECTANGLE);        /**         * 设置背景的颜色         */        GradientDrawable gd_fbackground = new GradientDrawable();        gd_fbackground.setStroke(5, Color.parseColor("#efefef"));        gd_fbackground.setColor(Color.parseColor("#efefef"));        gd_fbackground.setCornerRadius(10);        gd_fbackground.setGradientType(GradientDrawable.RECTANGLE);        rl_fbackground.setBackground(gd_fbackground);        rl_headimg.setBackground(gradientDrawable);        /**         *         * 采集导航图标         */        navList.add((ImageView) view.findViewById(R.id.activity_usercontext_btnPage_addrImage));        //收件地址        navList.add((ImageView) view.findViewById(R.id.activity_usercontext_btnPage_btnorderpage)        );//订单信息        navList.add((ImageView) view.findViewById(R.id.framelayout_userpage_btnServicePeo));//联系客服        navList.add((ImageView) view.findViewById(R.id.activity_usercontext_btnUserHelp));//帮助        navList.add((ImageView) view.findViewById(R.id.activity_usercontext_btnExchange));//兑换        navList.add((ImageView) view.findViewById(R.id.activity_usercontext_btnShare));//分享        //动画操作        timer = new Timer();        timer.schedule(new TimerTask() {            @Override            public void run() {                index--;                if(index < 0){                    timer.cancel();                }                else{                    Log.e(Config.DEBUG, "线程开始" + index);                    Message msg = new Message();                    msg.obj = index;                    msg.what = UPDATE_ANMIATION;                    handler.sendMessage(msg);                }            }        }, 500, 500);        Listener(view);    }    @SuppressLint("NewApi")    private void Listener(View view) {        /**         * 点击地址按钮         */        btn_addr.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                LCPF_StartActivity(UserAllAddrsAct.class);            }        });        /**         * 兑换卷的按钮监听         */        view.findViewById(R.id.activity_usercontext_btnExchange).setOnClickListener(new View                .OnClickListener() {            @Override            public void onClick(View v) {                LCPF_StartActivity(ExchangeAct.class);            }        });        view.findViewById(R.id.framelayout_userpage_btnServicePeo).setOnClickListener(new View                .OnClickListener() {            @Override            @SuppressLint("NewApi")            public void onClick(View v) {                com.zbyj.Yazhou.LeftCompanyProgram.ConfigPageClass.AlertViewIDpage                        alertViewIDpage = ConfigPageClass.getAlertViewIDpageInstance();                alertViewIDpage.setCanwindow(true);                View item = LayoutInflater.from(getContext()).inflate(R.layout                        .item_trueorfalse_dialog, null);                alertViewIDpage.setTitle((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_title));                alertViewIDpage.setContext((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_content));                alertViewIDpage.setCancle((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_btnCancle));                alertViewIDpage.setConfirm((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_btnDetermine));                Tools.showAlertDilg(item, getContext(), "提示", "为了保证您和客服的双向权益," +                        "本次通话我们可能会进行录音。并且我们需要您开启允许通话权限,是否继续?", "取消", "我已知晓,继续", new Tools                        .AlertDilgClick() {                    @Override                    public void onConfirm(AlertDialog alertDialog) {                        alertDialog.dismiss();                        //判断是否有拨打电话权限                        if (Tools.isPermission(getContext(), Manifest.permission.CALL_PHONE)) {                            Tools.callPhone(getContext(), Tools.getServicePeoPhone());                        } else {                            Toast.makeText(getContext(), "请打开您的拨打电话的权限", Toast.LENGTH_LONG).show();                            Tools.getPermission(getContext(), Manifest.permission.CALL_PHONE);                            UserPageFrame.this.requestPermissions(new String[]{Manifest                                    .permission.CALL_PHONE}, 2);                        }                    }                    @Override                    public void onCancle(AlertDialog alertDialog) {                        alertDialog.dismiss();                    }                }, alertViewIDpage);            }        });        view.findViewById(R.id.activity_usercontext_btnUserHelp).setOnClickListener(new View                .OnClickListener() {            @Override            public void onClick(View v) {                LCPF_StartActivity(UserHelpCenter.class);            }        });        /**         * 账户退出操作 清空TOKEN         */        view.findViewById(R.id.activity_userpage_btnBackAccount).setOnClickListener(new View                .OnClickListener() {            @Override            public void onClick(View v) {                com.zbyj.Yazhou.LeftCompanyProgram.ConfigPageClass.AlertViewIDpage                        alertViewIDpage = ConfigPageClass.getAlertViewIDpageInstance();                View item = LayoutInflater.from(getContext()).inflate(R.layout                        .item_trueorfalse_dialog, null);                alertViewIDpage.setCanwindow(true);                alertViewIDpage.setConfirm((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_btnDetermine));                alertViewIDpage.setContext((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_content));                alertViewIDpage.setTitle((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_title));                alertViewIDpage.setCancle((TextView) item.findViewById(R.id                        .item_trueorfalse_dialog_btnCancle));                Tools.showAlertDilg(item, getContext(), "提示", "确定操作之后," +                        "我们会清空手机里的记录。你可能无法进行预定/查询/领卷等的操作,确定操作?", "取消", "我已知晓", new Tools                        .AlertDilgClick() {                    @Override                    public void onConfirm(AlertDialog alertDialog) {                        alertDialog.dismiss();                        Tools.settoKen(getContext(), USER_KEY_PAGE.KEY_TOKEN, "");                        Tools.settoKen(getContext(), USER_KEY_PAGE.KEY_PHONE, "");                        FragmentTransaction ft = getFragmentManager().beginTransaction();//开始事务                        android.app.Fragment fg = getFragmentManager().findFragmentByTag                                ("mainPageFrame");                        android.app.Fragment userfg = getFragmentManager().findFragmentByTag                                ("userPageFrame");                        ft.show(fg);                        ft.hide(userfg);                        ft.commit();                    }                    @Override                    public void onCancle(AlertDialog alertDialog) {                        //不操作                        alertDialog.dismiss();                    }                }, alertViewIDpage);            }        });    }}